<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen" />
  <style type="text/css">
    html { height: 100%; }
    body { height: 100%; margin: 0; padding: 0; }
    #map-canvas { height: 100%; };
  </style>
  <script src="http://code.jquery.com/jquery.js"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5kXsecPZL9UEHQjL1gjwth-dGbrcXf2A&sensor=false"></script>
  <script type="text/javascript" src="path.js"></script>
  <script type="text/javascript">
    function initialize() {
      var mapOptions = {
        center: new google.maps.LatLng(37.301589, -121.926015),
        zoom: 11,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"),
        mapOptions);

      /* var dirRequest = {
        origin: new google.maps.LatLng(37.3007950, -121.9255450),
        destination: new google.maps.LatLng(37.3008950, -121.9255350),
        travelMode: google.maps.TravelMode.BICYCLING
      };
      var dirServices = new google.maps.DirectionsService();
      dirServices.route(
        dirRequest,
        function (result, status) {
          if (status == google.maps.DirectionsStatus.OK) {
            var renderer = new google.maps.DirectionsRenderer();
            renderer.setMap(map);
            renderer.setDirections(result);
          }
        }
      ); */

      /* var path = [
        new google.maps.LatLng(37.3007950, -121.9255450),
        new google.maps.LatLng(37.3008950, -121.9255350)
      ]; */

      var poly = new google.maps.Polyline({
        path: path,
        strokeColor: '#FF0000',
        strokeOpacity: 0.7,
        strokeWeight: 2
      });
      poly.setMap(map);

      $('#gpxfile').change(function() {
        var file = this.files[0];
        var formData = new FormData();
        formData.append('gpxfile', file);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/');
        xhr.onreadystatechange = function() {
          if (this.readyState == this.DONE) {
            if (this.status == 200) {
              console.log($.parseJSON(this.responseText)[0].latitude);
            }
          }
        };
        xhr.send(formData);
      });
    }
    google.maps.event.addDomListener(window, 'load', initialize);

    function loadFile() {
      $('#gpxfile').trigger('click');
    }
  </script>
</head>

<body>
  <div style="position: absolute; z-index: 1; top: 90%; left: 2%;">
    <div class="btn-group dropup">
      <a class="btn btn-large btn-inverse dropdown-toggle" data-toggle="dropdown" href="#">
        Tools
        <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="javascript:loadFile()">google</a></li>
        <li><a href="http://www.yahoo.com/">yahoo</a></li>
      </ul>
    </div>
  </div>
  <div id="map-canvas"></div>
  <form method="post" enctype="multipart/form-data" id="gpxform">
    <input type="file" name="gpxfile" id="gpxfile" style="opacity: 0;" />
    <input type="submit" id="gpxsend" style="opacity: 0;" />
  </form>
  <script src="bootstrap/js/bootstrap.min.js"></script>
</body>

</html>
